{% extends "base.html" %}
{% load i18n%}


{% block title %} {{ quiz.title }} | {% trans 'Learning management system' %} {% endblock %}
{% block description %} {{ quiz.title }} - {{ quiz.description }} {% endblock %}

{% block content %}

<nav aria-label="breadcrumb" class="mb-4">
	<ol class="breadcrumb bg-light p-2 rounded shadow-sm">
		<li class="breadcrumb-item"><a href="/" class="text-decoration-none"><i class="bi bi-house-door"></i> {% trans 'Home' %}</a></li>
		<li class="breadcrumb-item"><a href="{% url 'programs' %}" class="text-decoration-none"><i class="bi bi-collection"></i> {% trans 'Programs' %}</a></li>
		<li class="breadcrumb-item"><a href="{{ course.get_absolute_url }}" class="text-decoration-none"><i class="bi bi-book"></i> {{ course }}</a></li>
		<li class="breadcrumb-item"><a href="{% url 'quiz_index' course.slug %}" class="text-decoration-none"><i class="bi bi-question-square"></i> {% trans 'Quizzes' %}</a></li>
		<li class="breadcrumb-item active" aria-current="page"><i class="bi bi-play-circle"></i> {{ quiz.title|title }}</li>
	</ol>
</nav>

<div class="card border-0 shadow-sm mb-4">
	<div class="card-body bg-light">
		<div class="d-flex justify-content-between align-items-center">
			<h4 class="card-title d-flex align-items-center mb-0">
				<i class="bi bi-pencil-square text-primary me-2"></i>
				{{ quiz.title|title|truncatechars:25 }}
			</h4>
			{% if progress %}
			<span class="badge bg-danger rounded-pill">
				<i class="bi bi-list-ol me-1"></i>{% trans "Question" %} {{ progress.0|add:1 }} {% trans "of" %} {{ progress.1 }}
			</span>
			{% endif %}
		</div>
	</div>
</div>

<div class="container px-0">

	{% if previous.answers %}
	<div class="card border-0 shadow-sm mb-4">
		<div class="card-header bg-light">
			<h5 class="card-title mb-0 d-flex align-items-center">
				<i class="bi bi-arrow-left-circle text-primary me-2"></i>
				{% trans "Previous Question" %}
			</h5>
		</div>
		<div class="card-body">
			<p class="text-muted mb-1"><small>{% trans "The previous question" %}:</small></p>
			<p class="mb-3 fw-bold">{{ previous.previous_question }}</p>

			{% if previous.previous_outcome %}
			<div class="alert alert-success d-flex align-items-center">
				<i class="bi bi-check-circle-fill me-2"></i>
			{% else %}
			<div class="alert alert-warning d-flex align-items-center">
				<i class="bi bi-exclamation-triangle-fill me-2"></i>
			{% endif %}
				<p class="mb-0">
					<small>{% trans "Your answer was" %}</small>
					<strong>{{ previous.previous_outcome|yesno:"correct,incorrect" }}</strong>
				</p>
			</div>
			
			{% load i18n %}
			{% if previous.answers %}
			<div class="table-responsive">
				<table class="table table-hover">
					<tbody>
					{% for answer in previous.answers %}
						{% if answer.correct %}
						<tr class="table-success">
							<td class="align-middle">{{ answer }}</td>
							<td class="text-success align-middle"><i class="bi bi-check-circle me-2"></i><strong>{% trans "This is the correct answer" %}</strong></td>
						</tr>
						{% else %}
						<tr>
							<td class="align-middle">{{ answer }}</td>
							<td class="align-middle">
							{% if previous.question_type.MCQuestion %}
								{% if answer.id|add:"0" == previous.previous_answer|add:"0" %}
								<i class="bi bi-x-circle me-2 text-danger"></i>{% trans "This was your answer." %}
								{% endif %}
							{% endif %}
							</td>
						{% endif %}
						</tr>
					{% endfor %}
					</tbody>
				</table>
			</div>

			{% if user_was_incorrect %}
			<div class="alert alert-danger d-flex align-items-center">
				<i class="bi bi-x-circle-fill me-2"></i>
				<strong>{% trans "You answered the above question incorrectly" %}</strong>
			</div>
			{% endif %}
			{% endif %}

			<div class="card mt-3">
				<div class="card-header bg-light">
					<h6 class="mb-0 d-flex align-items-center">
						<i class="bi bi-info-circle text-primary me-2"></i>
						{% trans "Explanation" %}:
					</h6>
				</div>
				<div class="card-body bg-light">
					{% if previous.previous_question.explanation %}
					{{ previous.previous_question.explanation }}
					{% else %}
					{% trans "No explanation set to this question." %}
					{% endif %}
				</div>
			</div>
		</div>
	</div>
	<hr class="my-4">
	{% endif %}

	{% if question %}

	{% if progress.0|add:1 == 1 %}
	<div class="modal fade show" id="instractionModal" tabindex="-1" aria-labelledby="instractionModalLabel" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="instractionModalLabel">
						<i class="bi bi-info-circle me-2"></i>{% trans 'Quiz instructions' %}
					</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
				</div>
				<div class="modal-body">
					<div class="alert alert-warning d-flex">
						<i class="bi bi-exclamation-triangle-fill me-2 fs-4"></i>
						<div>
							{% blocktrans %} 
							You can't go back to the previous question after you submit it, 
							so double check your answer before proceeding to the next one!
							{% endblocktrans %}
						</div>
					</div>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-primary" data-bs-dismiss="modal">
						<i class="bi bi-check-circle me-2"></i>{% trans 'Understood' %}
					</button>
				</div>
			</div>
		</div>
	</div>
	{% endif %}

	<div class="card border-0 shadow-sm">
		<div class="card-header bg-light">
			<p class="mb-0">
				<small class="text-muted">{% trans "Quiz category" %}:</small>
				<span class="badge bg-primary">
					<i class="bi bi-tag me-1"></i>{{ quiz.category }}
				</span>
			</p>
		</div>
		<div class="card-body">
			<h5 class="card-title d-flex align-items-center mb-4">
				<i class="bi bi-question-circle text-primary me-2"></i>{{ question.content }}
			</h5>

			{% if question.figure %}
			<div class="col-md-8 mx-auto mb-4">
				<img class="img-fluid rounded" src="{{ question.figure.url }}" alt="{{ question.content }}"/>
			</div>
			{% endif %}
			
			<form action="" method="POST" class="mt-3">
				{% csrf_token %}
				<input type="hidden" name="question_id" value="{{ question.id }}">

				<div class="list-group">
					{% for answer in form.answers %}
					<label class="list-group-item list-group-item-action d-flex gap-2 py-3">
						{{ answer }}
					</label>
					{% endfor %}
				</div>
				
				<div class="d-grid gap-2 col-md-6 mx-auto mt-4">
					<button type="submit" class="btn btn-primary btn-lg">
						<i class="bi bi-check-circle me-2"></i>{% trans "Submit Answer" %}
					</button>
				</div>
			</form>
		</div>
	</div>
	{% endif %}
</div>

{% endblock %}

{% block js %}
<script>
	const instractionModal = new bootstrap.Modal('#instractionModal', {
		keyboard: false
	})
	instractionModal.show();
</script>
{% endblock js %}
