{% extends "base.html" %}
{% load i18n %}

{% block title %} {% trans "Progress Page" %} | {% trans 'Learning management system' %} {% endblock %}
{% block description %} {% trans "User Progress Page" %} {% endblock %}

{% block content %}

<div class="container-fluid py-4">
  <!-- Breadcrumb -->
  <nav aria-label="breadcrumb" class="mb-4">
    <ol class="breadcrumb">
      <li class="breadcrumb-item"><a href="/" class="text-decoration-none"><i class="bi bi-house-door me-1"></i>{% trans 'Home' %}</a></li>
      <li class="breadcrumb-item active" aria-current="page"><i class="bi bi-graph-up me-1"></i>{% trans 'Progress Page' %}</li>
    </ol>
  </nav>

  <!-- Page header -->
  <div class="card border-0 shadow-sm mb-4">
    <div class="card-body bg-light">
      <h4 class="mb-0 d-flex align-items-center">
        <i class="bi bi-bar-chart-line-fill text-primary me-2"></i>
        <span>{% trans 'Quiz Progress Records' %}</span>
      </h4>
    </div>
  </div>

  {% include 'snippets/messages.html' %}

  {% if cat_scores %}
  <div class="card border-0 shadow-sm mb-4">
    <div class="card-header bg-white">
      <h5 class="mb-0"><i class="bi bi-folder2-open text-primary me-2"></i>{% trans "Question Category Scores" %}</h5>
    </div>
    <div class="card-body p-0">
      <div class="table-responsive">
        <table class="table table-hover m-0">
          <thead class="bg-light">
            <tr>
              <th class="ps-3"><i class="bi bi-tag me-2"></i>{% trans "Category" %}</th>
              <th><i class="bi bi-check-circle me-2"></i>{% trans "Correctly answered" %}</th>
              <th><i class="bi bi-x-circle me-2"></i>{% trans "Incorrect" %}</th>
              <th><i class="bi bi-percent me-2"></i>{% trans "Percentage" %}</th>
            </tr>
          </thead>
          <tbody>
            {% for cat, value in cat_scores.items %}
            <tr>
              <td class="ps-3">{{ cat }}</td>
              <td>
                <span class="badge bg-success">{{ value.0 }}</span>
              </td>
              <td>
                <span class="badge bg-danger">{{ value.1 }}</span>
              </td>
              <td>
                <div class="progress" style="height: 20px; width: 100px;">
                  <div class="progress-bar {% if value.2 >= 70 %}bg-success{% elif value.2 >= 50 %}bg-warning{% else %}bg-danger{% endif %}" 
                      role="progressbar" style="width: {{ value.2 }}%;" 
                      aria-valuenow="{{ value.2 }}" aria-valuemin="0" aria-valuemax="100">{{ value.2 }}%</div>
                </div>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
  {% endif %}

  {% if exams %}
  <div class="card border-0 shadow-sm mb-4">
    <div class="card-header bg-white">
      <h5 class="mb-0"><i class="bi bi-journal-check text-primary me-2"></i>{% trans "Previous Exam Papers" %}</h5>
    </div>
    <div class="card-body">
      <p class="lead">
        {% if request.user.is_superuser %}
        <i class="bi bi-person-badge me-2"></i>{% trans "Student exam results" %}
        {% else %}
        <i class="bi bi-card-checklist me-2"></i>{% trans "Below are the results of exams that you have sat" %}
        {% endif %}
      </p>

      <div class="alert alert-info d-flex align-items-center">
        <i class="bi bi-info-circle-fill me-2"></i>
        <div>{% trans 'Total complete exams:' %} <span class="badge bg-secondary">{{ exams_counter }}</span></div>
      </div>

      <div class="table-responsive">
        <table class="table table-hover m-0">
          <thead class="bg-light">
            <tr>
              <th class="ps-3">#</th>
              <th><i class="bi bi-journal-text me-2"></i>{% trans "Quiz Title" %}</th>
              <th><i class="bi bi-trophy me-2"></i>{% trans "Score" %}</th>
              <th><i class="bi bi-calculator me-2"></i>{% trans "Possible Score" %}</th>
              <th><i class="bi bi-percent me-2"></i>{% trans 'Out of 100%' %}</th>
            </tr>
          </thead>
          <tbody>
            {% for exam in exams %}
            <tr>
              <td class="ps-3">{{ forloop.counter }}.</td>
              <td>
                <a href="#" class="text-decoration-none d-flex align-items-center">
                  <i class="bi bi-file-earmark-text me-2 text-muted"></i>
                  <span>{{ exam.quiz.title }}</span>
                </a>
              </td>
              <td>{{ exam.current_score }}</td>
              <td>{{ exam.get_max_score }}</td>
              <td>
                <span class="badge {% if exam.get_percent_correct >= 70 %}bg-success{% elif exam.get_percent_correct >= 50 %}bg-warning{% else %}bg-danger{% endif %}">
                  {{ exam.get_percent_correct }}%
                </span>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
  {% endif %}

  {% if not cat_scores and not exams %}
  <div class="card border-0 shadow-sm">
    <div class="card-body text-center py-5">
      <i class="bi bi-folder2-open text-muted" style="font-size: 3rem;"></i>
      <h5 class="mt-3 text-muted">{% trans 'Progress records will appear here' %}</h5>
      <p class="text-muted mb-0">{% trans 'Complete quizzes to see your progress history' %}</p>
    </div>
  </div>
  {% endif %}
</div>

{% endblock %}
